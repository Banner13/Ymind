[TOC]

# hex格式解析

## 来源历史
	来源：1973 Intel
    设计目的：为Intel的Intellec 微型计算机开发系统(MDS)设计的，以便从纸带加载和执行程序。
    应用：烧录程序通过读取HEX文件将机器代码写入PROM或传输到目标系统以进行加载和执行。

## 格式
```hex
:AABBBBCCDD..
或者
:AABBBBCCDDDDEE..
```

### 格式解析
	.hex文件按行进行存储。
    ':'(0x3A)           -- 冒号作为起始符号。(冒号前的字符将不被识别)。
    'AA'                -- "冒号"后的第一字节表示数据区的字节数。
    'BBBB'              -- "字节数"后的两个字节表示偏移地址。
	'CC'                -- "偏移地址"后的一个字节定义数据字段的含义。
    'DD'                -- "含义"后的'BBBB'个字节是数据。
    'EE'                -- "数据"后一个字节是校验和。(如果存在)。
    '..'(0x0D)(0x0A)    -- 换行符。

### 说明
	'CC'说明：有以下五种类型。
    '00' Data Record:                          数据记录
    '01' End of File Record:                   标识文件结束
    '02' Extended Segment Address Record:      扩展段地址
    '03' Start Segment Address Record:         段地址
    '04' Extended Linear Address Record:       扩展线性地址
    '05' Start Linear Address Record:          程序启动运行的地址
                                               除此以外，一些第三方也定义了许多类型。
    扩展线性地址：用于扩展'BBBB'能表示的范围。
    实际烧录地址 = 扩展线性地址 + 偏移地址。
    扩展段地址同上。

	'EE'说明：校验和 = 0x100 - 累加和。(AABBBBCCDD中的所有数值，按照ASCII表示值，依次相加)。
    例如
    :020000040900F1..
	F1 = 0x100 - (02 + 00 + 00 + 04 + 09 + 00)。

## 实例
```hex
3a 30 32 30 30 30 30 30 34 30 39 30 30 46 31 0d
0a 3a 30 34 30 30 30 30 30 30 46 46 45 37 46 45
45 37 33 31 0d 0a 3a 30 34 30 30 30 34 30 30 46
38 42 35 30 30 42 46 38 43 0d 0a 3a 30 34 30 30
30 38 30 30 46 38 42 35 30 30 42 46 38 38 0d 0a
3a 30 34 30 30 30 30 30 35 30 39 30 30 30 30 30
30 45 45 0d 0a 3a 30 30 30 30 30 30 30 31 46 46
0d 0a
```

```ascii
注: "换行符不可见，由 '..' 表示"
:020000040900F1..
:04000000FFE7FEE731..
:04000400F8B500BF8C..
:04000800F8B500BF88..
:0400000509000000EE..
:00000001FF..
```

    格式解析后得到
    :02  0000  04  0900      F1..    // 设置扩展线性地址为 0x0900
    :04  0000  00  FFE7FEE7  31..    // 数据FFE7FEE7写入 0x0900-0000
    :04  0004  00  F8B500BF  8C..    // 数据F8B500BF写入 0x0900-0004
    :04  0008  00  F8B500BF  88..    // 数据F8B500BF写入 0x0900-0008
    :04  0000  05  09000000  EE..    // 程序开始地址为 0x9000-0000
    :00  0000  01            FF..    // hex文件结束

## 扩展
	bin文件只保留了hex文件中的'DD'部分，所以在烧录时需要指定烧录地址。

## 参考资料
https://blog.csdn.net/fengel_cs/article/details/123511474
https://www.intel.com/content/www/us/en/programmable/quartushelp/17.0/reference/glossary/def_hexfile.htm
https://en.wikipedia.org/wiki/Intel_HEX


